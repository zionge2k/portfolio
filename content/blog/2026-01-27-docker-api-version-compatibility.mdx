---
title: "Docker API 버전 호환성 이슈"
description: "GitLab CI/CD에서 Docker client와 daemon 간 API 버전 불일치로 빌드가 실패하는 원인과 해결 방법"
date: "2026-01-27"
tags: ["docker", "troubleshooting", "ci-cd"]
published: true
---

## 시나리오

GitLab CI/CD에서 Self-hosted Runner를 사용하여 Docker 이미지를 빌드하는 중이었다. Server 프로젝트는 성공했지만 Client 프로젝트에서 실패.

## 문제 / 발견

```
Error response from daemon: client version 1.43 is too old.
Minimum supported API version is 1.44, please upgrade your client to a newer version
```

`docker login` 명령에서 위 에러 발생.

## 원인 / 이유

**Docker API 버전 불일치**:

| 구성 요소 | 버전 |
|----------|------|
| Host Docker daemon | 29.1.1 (API 1.44+) |
| CI 이미지 `docker:24` | Client API 1.43 |

Docker daemon은 **최소 API 버전**을 요구할 수 있으며, 오래된 client는 거부된다.

**왜 Server는 성공했나?**
- Server: `image: eclipse-temurin:17-jdk` + `apt-get install docker.io`
  - Ubuntu 저장소의 docker.io는 최신 버전
- Client: `image: docker:24`
  - Alpine 기반 Docker 이미지, 버전 고정

## 해결 / 핵심 포인트

### CI 이미지 버전 업그레이드

```yaml
# Before
image: docker:24  # API 1.43

# After
image: docker:27  # API 1.46+
```

### Docker 버전과 API 매핑

| Docker 버전 | API 버전 |
|-------------|----------|
| 24.x | 1.43 |
| 25.x | 1.44 |
| 26.x | 1.45 |
| 27.x | 1.46 |

### 버전 확인 방법

```bash
# Client 버전
docker version --format '{{.Client.APIVersion}}'

# Server(daemon) 버전
docker version --format '{{.Server.APIVersion}}'

# 최소 지원 API 버전
docker version --format '{{.Server.MinAPIVersion}}'
```

## 코드

**.gitlab-ci.yml 수정**:

```yaml
build-dev:
  stage: build
  image: docker:27  # 24 → 27로 업그레이드
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_JOB_TOKEN $CI_REGISTRY
    - docker build -t $IMAGE_NAME:$TAG .
    - docker push $IMAGE_NAME:$TAG
```

## 참고

- [Docker Engine API version history](https://docs.docker.com/engine/api/)
- Host daemon 버전에 맞는 client 이미지 사용 필수
- `docker:latest` 대신 명시적 버전 태그 권장 (재현성)
- Self-hosted Runner 환경에서는 Host Docker 버전 확인 중요
